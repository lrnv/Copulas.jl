<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Influence of the method of estimation · Copulas.jl</title><meta name="title" content="Influence of the method of estimation · Copulas.jl"/><meta property="og:title" content="Influence of the method of estimation · Copulas.jl"/><meta property="twitter:title" content="Influence of the method of estimation · Copulas.jl"/><meta name="description" content="Documentation for Copulas.jl."/><meta property="og:description" content="Documentation for Copulas.jl."/><meta property="twitter:description" content="Documentation for Copulas.jl."/><meta property="og:url" content="https://lrnv.github.io/Copulas.jl/examples/ifm1/"/><meta property="twitter:url" content="https://lrnv.github.io/Copulas.jl/examples/ifm1/"/><link rel="canonical" href="https://lrnv.github.io/Copulas.jl/examples/ifm1/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/citations.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img class="docs-light-only" src="../../assets/logo.svg" alt="Copulas.jl logo"/><img class="docs-dark-only" src="../../assets/logo-dark.svg" alt="Copulas.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Copulas.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../getting_started/">Getting Started</a></li><li><a class="tocitem" href="../../sklar/">Sklar&#39;s Distributions</a></li><li><a class="tocitem" href="../../elliptical/generalities/">Elliptical Copulas</a></li><li><a class="tocitem" href="../../archimedean/generalities/">Archimedean Copulas</a></li><li><a class="tocitem" href="../../Liouville/">Liouville Copulas</a></li><li><a class="tocitem" href="../../empirical/generalities/">Empirical Copulas</a></li><li><a class="tocitem" href="../../dependence_measures/">Dependence measures</a></li></ul></li><li><span class="tocitem">Bestiary</span><ul><li><a class="tocitem" href="../../elliptical/available_models/">Elliptical Copulas</a></li><li><a class="tocitem" href="../../archimedean/available_models/">Archimedean Generators</a></li><li><a class="tocitem" href="../../empirical/available_models/">Empirical Copulas</a></li><li><a class="tocitem" href="../../miscellaneous/">Other Copulas</a></li><li><a class="tocitem" href="../../transformations/">Transformed Copulas</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../lambda_viz/">Empirical Kendall function and Archimedean&#39;s λ function.</a></li><li><a class="tocitem" href="../lossalae/">Loss-Alae fitting example.</a></li><li><a class="tocitem" href="../fitting_sklar/">Fitting compound distributions</a></li><li class="is-active"><a class="tocitem" href>Influence of the method of estimation</a></li><li><a class="tocitem" href="../turing/">Bayesian inference with <code>Turing.jl</code></a></li><li><a class="tocitem" href="../other_usecases/">Other known use cases.</a></li></ul></li><li><a class="tocitem" href="../../dev_roadmap/">Dev Roadmap</a></li><li><a class="tocitem" href="../../idx/">Package Index</a></li><li><a class="tocitem" href="../../references/">References</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Influence of the method of estimation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Influence of the method of estimation</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/lrnv/Copulas.jl/blob/main/docs/src/examples/ifm1.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Influence-of-the-method-of-estimation"><a class="docs-heading-anchor" href="#Influence-of-the-method-of-estimation">Influence of the method of estimation</a><a id="Influence-of-the-method-of-estimation-1"></a><a class="docs-heading-anchor-permalink" href="#Influence-of-the-method-of-estimation" title="Permalink"></a></h1><p>The possibility to fit directly the copula and the marginals through the <code>SklarDist</code> interface is very practical if you want a quick and dirty fit to be produce for a given dataset. It works as follows: </p><pre><code class="language-julia hljs">using Copulas, Distributions
X₁ = Normal()
X₂ = LogNormal()
X₃ = Gamma()
C = GaussianCopula([
    1.0 0.4 0.1
    0.4 1.0 0.8
    0.1 0.8 1.0
])
D = SklarDist(C,(X₁,X₂,X₃))
x = rand(D,100)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">3×100 Matrix{Float64}:
 -1.39312    -0.523514  0.0453745  …  1.59848   -0.696861  -0.406431
  0.194376    1.23653   0.639253      2.03046    0.607845   0.859377
  0.0852707   0.263674  0.383123      0.336304   0.796611   0.135326</code></pre><p>And we can fit the same model directly as follows: </p><pre><code class="language-julia hljs">quick_fit = fit(SklarDist{GaussianCopula, Tuple{Normal,LogNormal,Gamma}}, x)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">SklarDist{GaussianCopula{3, Matrix{Float64}}, Tuple{Distributions.Normal{Float64}, Distributions.LogNormal{Float64}, Distributions.Gamma{Float64}}}(
C: GaussianCopula{3, Matrix{Float64}}(
Σ: [0.9999999999999999 0.32353979238554803 -0.05674175314133668; 0.32353979238554803 1.0 0.7814917894844814; -0.05674175314133668 0.7814917894844814 0.9999999999999998]
)

m: (Distributions.Normal{Float64}(μ=-0.10067484101525558, σ=1.0382207646881034), Distributions.LogNormal{Float64}(μ=0.024753464091829172, σ=0.9577518061207533), Distributions.Gamma{Float64}(α=0.8258826513261893, θ=1.2948418764358405))
)
</code></pre><p>However, we should be clear about what this is doing. There are several way of estimating compound parametric models: </p><ul><li><strong>Joint estimation (JMLE):</strong> This method simply compute the joint loglikelyhood <span>$\log f_D$</span> of the random vector <code>D</code> and maximize, jointly, w.r.t. the parameters of the dependence structure and the parameters of the marginals. This is the easiest to understand, but not the easiest numerically as the produces loglikelihood can be highly non-linear and computations can be tedious. </li><li><strong>Inference functions for margins (IFM):</strong> This method splits up the process into two parts: the marginal distributions <span>$F_{i}, i \in 1,..d$</span> are estimated first, separately from each other, through maximum likelihood on marginal data. Denote <span>$\hat{F}_{i}$</span> these estimators. Then, we fit the copula on pseudo-observations, but these pseudo-observations could be computed in two different ways: <ul><li><strong>IFM1:</strong> We use empirical ranks to compute the pseudo-observations.</li><li><strong>IFM2:</strong> We leverage the estimated distribution functions <span>$\hat{F}_{i}$</span> for the marginals to compute the pseudo-observations as <span>$u_{i,j} = $\hat{F}_{i}(x_{i,j})$</span>.</li></ul></li></ul><p>The <code>fit(SklarDist{...},...)</code> method in the <code>Copulas.jl</code> package is implemented as follows: </p><pre><code class="language-julia hljs">function Distributions.fit(::Type{SklarDist{CT,TplMargins}},x) where {CT,TplMargins}
    # The first thing to do is to fit the marginals : 
    @assert length(TplMargins.parameters) == size(x,1)
    m = Tuple(Distributions.fit(TplMargins.parameters[i],x[i,:]) for i in 1:size(x,1))
    u = pseudos(x)
    C = Distributions.fit(CT,u)
    return SklarDist(C,m)
end</code></pre><p>and so clearly performs <strong>IFM1</strong> estimation. <strong>IFM2</strong> is not much harder to implement, it could be done for our model as follows:</p><pre><code class="language-julia hljs"># Marginal fits are the same than IFM1, so we just used those to compute IFM2 ranks:
u = similar(x)
for i in 1:length(C)
    u[i,:] .= cdf.(Ref(quick_fit.m[i]), x[i,:])
end

# estimate a Gaussian copula:
ifm2_cop = fit(GaussianCopula,u)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">GaussianCopula{3, Matrix{Float64}}(
Σ: [1.0000000000000002 0.34670275640497683 -0.043771397776678427; 0.34670275640497683 1.0000000000000002 0.7897829848498986; -0.043771397776678427 0.7897829848498986 0.9999999999999999]
)
</code></pre><p>Let us compare the two obtained correlation matrices: </p><pre><code class="language-julia hljs">ifm2_cop.Σ .- quick_fit.C.Σ</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">3×3 Matrix{Float64}:
 3.33067e-16  0.023163     0.0129704
 0.023163     2.22045e-16  0.0082912
 0.0129704    0.0082912    1.11022e-16</code></pre><p>We see that the estimated parameter is not exactly the same, which is normal. However, even in this contrived example, the difference between the two is not striking. Whether one method is better than the other is unclear, but the JMLE method is clearly superior by definition. However, due to its complexity, most software do not perform such an estimation. </p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../fitting_sklar/">« Fitting compound distributions</a><a class="docs-footer-nextpage" href="../turing/">Bayesian inference with <code>Turing.jl</code> »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Saturday 24 February 2024 07:51">Saturday 24 February 2024</span>. Using Julia version 1.10.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
